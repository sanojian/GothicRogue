<!DOCTYPE html>
<!--
	Mystery of the Unearthly Ichor - an HTML5 game written for the 7DRL 2014
	Copyright (C) 2014 Jonas "sanojian" Olmstead 
	
	Artwork - Oryx (http://oryxdesignlab.com/)
	Music - Deceased Superior Technician (http://www.nosoapradio.us/)
	Map Generation - ROguelike Toolkit in JavaScript (http://ondras.github.io/rot.js/hp/)
	
	Thanks for buzzjs, craftyjs, and rot.js!
-->
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<title>Unearthly Ichor</title>
	<script type="text/javascript" src="./includes/crafty.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="./gameDefines.js"></script>
    <script type="text/javascript" src="./public/js/game.js"></script>
    <script type="text/javascript" src="./includes/ROT.min.js"></script>
	<script type="text/javascript" src="./includes/buzz.min.js"></script>

    <link href='./public/css/gui.css' rel='stylesheet' type='text/css'>
    <link href='./public/css/icons.css' rel='stylesheet' type='text/css'>
	<link href='//fonts.googleapis.com/css?family=IM+Fell+Double+Pica+SC' rel='stylesheet' type='text/css'>

	<script language="javascript">
"use strict";


var RENDERING_MODE = 'DOM';//'Canvas';
var GAME_FONT = '"IM Fell Double Pica SC", serif';
var ZOOM = 1;
var TILE_WIDTH = 32*ZOOM;
var TILE_HEIGHT = 32*ZOOM;
var TERRAIN_WIDTH = TILE_WIDTH;
var TERRAIN_HEIGHT = TILE_HEIGHT * 1.5 + ZOOM;
var VIEW_WIDTH = 800;
var VIEW_HEIGHT = 480;

var g_game = {
	slashEffects: {
		objArray: [],
		cursor: 0,
		getNextEffect: function() {
			g_game.slashEffects.cursor = (g_game.slashEffects.cursor + 1) % g_game.slashEffects.objArray.length;
			return g_game.slashEffects.objArray[g_game.slashEffects.cursor];
		}
	},
	sounds: {},
	music: {},
	curLevel: 0,
    ichorAmount: 0
};

window.addEventListener("load", function(event) {

	//VIEW_WIDTH = $(document).width();
	//VIEW_HEIGHT = $(document).height();
	Crafty.init(VIEW_WIDTH, VIEW_HEIGHT);
	
    g_game.wizardControls = String.fromCharCode(38) + String.fromCharCode(37) + String.fromCharCode(40) + String.fromCharCode(39);

	doCraftyInitialization();
});


function centerOnPlayers() {
	try {
		Crafty.viewport.x = VIEW_WIDTH/2 - g_game.wizard.locX * TILE_WIDTH;
		Crafty.viewport.y = VIEW_HEIGHT/2 - g_game.wizard.locY * TILE_HEIGHT;
		//Crafty.viewport.pan('x', Crafty.viewport.x - (VIEW_WIDTH/2 - newX * TILE_WIDTH), 10);
		//Crafty.viewport.pan('y', Crafty.viewport.y - (VIEW_HEIGHT/2 - newY * TILE_HEIGHT), 10);
		updateMiniMap();
	} catch(ex) {}
}


function getTextForLoot(level) {
	if (level == 5) {
		return 'Epic!';
	}
	else if (level == 4) {
		return 'Legendary';
	}
	else if (level == 3) {
		return 'Enchanted';
	}
	else if (level == 2) {
		return 'Enforced';
	}
	return 'Sturdy';

}

function getXPforLevel(level) {
	var amt = 0;
	var i = level;
	while (i > 0) {
		amt += i;
		i--;
	}
	
	return amt;
}

function doCraftyInitialization() {

    init_Mob();
    init_Player();
    init_fx();
    init_Spells();
    init_world();
    init_scenes();


	Crafty.scene("loading");	

}

function playSong(newSong) {
	if (g_game.songTitle != newSong) {
		g_game.songTitle = newSong;
		if (g_game.song) {
			g_game.song.stop();
		}
		g_game.song = new buzz.sound( "./audio/music/" + newSong, {
			formats: [ "ogg" ]
		});		
		g_game.song.setVolume(60).play().loop();
	}
}		


	</script>
</head>
<body>

<div id="divGUI" style="width: 100%; height: 100%;">
	<img id="imgCharBox" src="./images/charSheet.png" style="position: absolute;z-index: 10000;" />
    <div id="divPortrait" class="charPortrait"></div>
    <div id="charSlot0" class="charSlot"></div>
    <div id="charSlot1" class="charSlot"></div>
	<div id="divCharHealth" style="background: #BE2633;position: absolute;width: 80px; height: 12px;z-index: 9000"></div>
	<div id="divCharMana" style="background: #005784;position: absolute;width: 30px; height: 42px;z-index: 9000"></div>
	<!--div id="divwizardSpellProgress" style="background-image: url(./images/spellProgress.png);height: 48px; width: 240px;position: absolute;z-index: 11000"></div-->
    <div id="divCharNameText" class='nameText'>00</div>
	<!--div id="divwizardSpells" style="background-image: url(./images/spell_background.png); position: absolute;z-index: 11000;">
		<img id="imgSpell_Missle" class="spellImage" src="./images/spell_missle.png" />
		<img id="imgSpell_Fireball" class="spellImage" src="./images/spell_fireball.png" />
		<img id="imgSpell_Sleep" class="spellImage" src="./images/spell_sleep.png" />
		<img id="imgSpell_Lightening" class="spellImage" src="./images/spell_lightening.png" />
	</div-->
	<div id="divCharSpellControls" class="playerControls" style="position: absolute;z-index: 120000;">
		<div id="divKeySpell1" class="keyText">1</div>
		<div id="divKeySpell2" class="keyText">2</div>
		<div id="divKeySpell3" class="keyText">3</div>
		<div id="divKeySpell4" class="keyText">4</div>
	</div> 
	<div id="divCharControls" class="playerControls" style="background-image: url(./images/controls.png); position: absolute;z-index: 11000;">
		<div id="divKeyUp" class="keyText">W</div>
		<div id="divKeyLeft" class="keyText">A</div>
		<div id="divKeyDown" class="keyText">S</div>
		<div id="divKeyRight" class="keyText">D</div>
	</div>
    <img id="imgIchorMeter" src="./images/ichorMeter.png" style="position: absolute;z-index: 11000; opacity: 0.8;" />
    <div id="divIchorMeter" class="ichorMeter"></div>

	<canvas id="canvasMiniMap"></canvas>
	
	<!--div id="divOverlay" style="background-image: url(./images/meshx22.png);background-repeat:repeat;position: absolute;z-index: 8000"></div-->
</div>	
</body>
